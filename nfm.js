!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var s,a,n,r,h,l,o,u,d,p;i.r(e),function(t){t[t.ALL=-1]="ALL",t[t.US=1]="US",t[t.UN=2]="UN",t[t.IJ=3]="IJ",t[t.KM=4]="KM",t[t.SN=5]="SN",t[t.FR=6]="FR",t[t.IT=7]="IT"}(s||(s={})),function(t){t[t.DD=0]="DD",t[t.CL=1]="CL",t[t.CA=2]="CA",t[t.BB=3]="BB",t[t.CV=4]="CV",t[t.SS=5]="SS",t[t.ALL=-1]="ALL"}(a||(a={})),function(t){t[t.F=0]="F",t[t.E=1]="E",t[t.D=2]="D",t[t.C=3]="C",t[t.B=4]="B",t[t.A=5]="A",t[t.S=6]="S",t[t.ALL=-1]="ALL"}(n||(n={})),function(t){t[t.OPERATOR=0]="OPERATOR",t[t.ARMAMENT=1]="ARMAMENT",t[t.ENGINE=2]="ENGINE",t[t.REPAIR=3]="REPAIR",t[t.RADIO=4]="RADIO",t[t.SEAMAN=5]="SEAMAN",t[t.AVIATION=6]="AVIATION"}(r||(r={})),function(t){t[t.STEEL=0]="STEEL",t[t.GOLD=1]="GOLD"}(h||(h={})),function(t){t[t.GUN=0]="GUN",t[t.LAUCHER=1]="LAUCHER"}(l||(l={})),function(t){t[t.TORPEDO=0]="TORPEDO",t[t.MINE=1]="MINE"}(o||(o={})),function(t){t[t.FCS=0]="FCS",t[t.AUTO_GUN=1]="AUTO_GUN",t[t.LAUNCHER=2]="LAUNCHER",t[t.ARMOR=3]="ARMOR",t[t.HULL=4]="HULL",t[t.AIRCRAFT=5]="AIRCRAFT",t[t.FLIGHTDECK=6]="FLIGHTDECK",t[t.OXYGEN=7]="OXYGEN",t[t.ENGINE=8]="ENGINE",t[t.GUN=9]="GUN",t[t.RESTORE=10]="RESTORE"}(u||(u={})),function(t){t[t.BELT=1]="BELT",t[t.DECK=2]="DECK",t[t.BULGE=3]="BULGE",t[t.HULL=4]="HULL"}(d||(d={})),function(t){t[t.SCOUT=1]="SCOUT",t[t.FIGHTER=2]="FIGHTER",t[t.TORPEDO=3]="TORPEDO",t[t.BOMBER=4]="BOMBER"}(p||(p={}));let m=3;function c(t){return`${(t/100).toFixed(2)} Sec`}function _(t){return`${t} kn`}var f=function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,h)}l((s=s.apply(t,e||[])).next())})};class g{static wait(){return new Promise((t,e)=>{setTimeout(()=>t(),10)})}static GetAsync(t){return f(this,void 0,void 0,function*(){let e=null;for($.get(t,function(t){e=t});null==e;)yield this.wait();return e})}}var x=function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,h)}l((s=s.apply(t,e||[])).next())})};class S{static init(){return x(this,void 0,void 0,function*(){this.m_db=null;let t=window.SQL;var e=new XMLHttpRequest;for(e.open("GET","./db/nfm_dbase.sql3",!0),e.responseType="arraybuffer",e.onload=function(e){var i=new Uint8Array(this.response);S.m_db=new t.Database(i)},e.send();null==this.m_db;)yield g.wait()})}static query(t,e){let i=`select * from ${t}`;if(e){i+=" where ";let t=[];for(let i in e)t.push(`${i}=${e[i]}`);i+=t.join(" and ")}console.log(i);let s=this.m_db.exec(i),a=[];if(0==s.length)return a;for(let t=0;t<s[0].values.length;t++){let e=s[0].values[t],i=Object();for(let t=0;t<s[0].columns.length;t++){i[s[0].columns[t]]=e[t]}a.push(i)}return a}EquipmentType2Enum(t){switch(t){case"Gun":return u.GUN;case"AutoGun":return u.AUTO_GUN;case"FCS":return u.FCS;case"Engine":return u.ENGINE;case"Launcher":return u.LAUNCHER;case"Armor":return u.ARMOR;case"Hull":return u.HULL;case"Aircraft":return u.AIRCRAFT;case"FlightDeck":return u.FLIGHTDECK;case"Oxygen":return u.OXYGEN;default:return-1}}}let A=[{types:"FCS",typev:u.FCS},{types:"AutoGun",typev:u.AUTO_GUN},{types:"Launcher",typev:u.LAUNCHER},{types:"Armor",typev:u.ARMOR},{types:"Hull",typev:u.HULL},{types:"Aircraft",typev:u.AIRCRAFT},{types:"FlightDeck",typev:u.FLIGHTDECK},{types:"Oxygen",typev:u.OXYGEN},{types:"Engine",typev:u.ENGINE},{types:"Gun",typev:u.GUN},{types:"Restore",typev:u.RESTORE}];class E{constructor(){this.id=0,this.buildingtime=0,this.steel=0,this.gold=0}loadEquipmentInfo(t,e){this.buildingtime=t[`${e}_BuildTime`],this.steel=t[`${e}_Steel`],this.gold=t[`${e}_Gold`]}export(){let t="";return t=this.gold>0?`${this.gold}`:this.steel>0?`${this.steel}`:"default",[this.buildingtime.toString(),t]}}class v{constructor(){this.count=0,this.levels=[]}static isValid(t,e,i){let s=`${e}${i}`,a=0;return 0!=(a="A"==e&&1==i?t[`${s}_TYPE`]:t[`${s}1_TYPE`])}static getEquipmentTypeById(t){return t>=4e3&&t<5e3?u.AUTO_GUN:t>=5e3&&t<6e3?u.LAUNCHER:(console.error(`err id=${t}`),-1)}static getEquipmentTypeByStr(t){let e=A.findIndex(e=>e.types==t);return A[e].typev}}class b extends E{init(t){this.id=t.Serial_SNDB,this.name=t.FCSName,this.nation=t.NationCode,this.acc=t.AccuracyBonus,this.torpedodist=t.TorpedoDistance,this.sightdist=t.ViewDistance,this.radarrange=t.RadarRange,this.sonarrange=t.SonarRange,this.criticalrate=t.CriticalBonus}export(){let t=super.export();return[this.name,"+"+this.acc,this.sightdist.toString(),this.radarrange.toString(),this.sonarrange.toString(),this.torpedodist.toString(),`+${this.criticalrate}%`].concat(t)}}var w=function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,h)}l((s=s.apply(t,e||[])).next())})};class y{static init(t){return w(this,void 0,void 0,function*(){this.m_trans=new Map;let e=`./asset/localizable/${t}/Localizable.strings`,i=yield g.GetAsync(e),s=(i=i.replace("\n","")).split(";");for(let t of s){if(""==t)continue;let e=t.split("=");""!=e[0]&&null!=e[1]&&(e[0]=this.Trim(e[0]),e[1]=this.Trim(e[1]),e[0]=e[0].substr(1,e[0].length-2),e[1]=e[1].substr(1,e[1].length-2),this.m_trans.set(e[0],e[1]))}console.log(this.m_trans.size+" loaded")})}static str(t,e){return this.m_trans.has(t)?this.m_trans.get(t):e}static Trim(t){return t.replace(/(^\s*)|(\s*$)/g,"")}}let N=[{v:p.SCOUT,s:"LS_SCOUTS"},{v:p.FIGHTER,s:"LS_FIGHTERS"},{v:p.TORPEDO,s:"LS_TORPEDO_BOMBERS"},{v:p.BOMBER,s:"LS_DIVE_BOMBERS"}];class T{init(t){this.id=t.Serial_SNDB,this.name=t.AircraftName,this.type=t.AirCraftType,this.sightrange=t.SightRange,this.DP=t.DP,this.speed=t.Speed,this.fuel=t.Fuel,this.attack=t.Attack,this.attackgap=t.AttackGap,this.defenceap=t.DefenceAP,this.readytime=t.ReadyTime,this.torpedospeed=t.SpeedHi,this.torpedodamage=t.TorpedoHEDamage,this.hedamage=t.HEDamage,this.apdamagebouns=t.APDamageBonus}export(){let t=this,e=N.find(e=>e.v==t.type).s,i=y.str(e,e);return[this.name,i,this.sightrange,this.DP,this.speed,this.fuel,this.attack,this.attackgap,this.defenceap,this.readytime,this.torpedospeed,this.torpedodamage,this.hedamage,this.apdamagebouns]}}class R extends E{constructor(){super(),this.plainMap=new Map}exportAircraftPlains(){let t=super.export(),e=[];for(let i of this.plainMap.values())e.push(i.export().concat(t));return e}}class D extends E{init(t){this.id=t.Serial_SNDB,this.name=t.GunSetName,this.nation=t.NationCode,this.barrelnum=t.TurretType,this.maxanglev=t.AngleMaxVertical,this.reloadtime=t.ReloadTime,this.turnspeed=t.TaskSpeed,this.hedamage=t.HEDamage,this.calibre=t.Calibre,this.aaw=t.AAW,this.aadamage=t.AADamage,this.range=t.GameMaxDist}export(){let t=super.export();return[this.name,"x"+this.klass.count,"x"+this.barrelnum,(this.calibre/100).toFixed(2)+'"',this.hedamage.toString(),this.range.toString(),c(this.reloadtime),`${this.turnspeed} Deg/Sec`,this.aadamage.toString(),1==this.aaw?"yes":""].concat(t)}exportAsLauncher(){let t=super.export();return[this.name,"x"+this.klass.count,"x"+this.barrelnum,this.hedamage,this.range,c(this.reloadtime),""].concat(t)}}class L extends E{init(t){this.id=t.Serial_SNDB,this.name=t.TpLauncherName,this.nation=t.NationCode,this.bundle=t.Bundle,this.turnspeed=t.Task_Speed,this.anglenarrow=t.FireAngleNarrow,this.anglewide=t.FireAngleWide,this.reloadtime=t.ReloadTime,this.shelltype=t.ShellType,this.speedlo=t.SpeedLo,this.speedhi=t.SpeedHi,this.hittype=t.HitType,this.minrange=t.MinRange,this.speedlorange=t.Crusing_Range_SpeedLo,this.speedhirange=t.Crusing_Range_SpeedHi,this.hedamage=t.HEDamage}export(){let t=super.export(),e="";return e=this.shelltype==o.TORPEDO?this.speedlo+" Kn":"",[this.name,"x"+this.klass.count,"x"+this.bundle.toString(),this.hedamage.toString(),this.speedlorange.toString(),`${c(this.reloadtime)}`,e].concat(t)}}class q extends E{init(t){this.id=t.Serial_SNDB,this.nation=t.NationCode,this.scout=t.Scout,this.fighter=t.Fighter,this.torpedo=t.Torpedo,this.bomber=t.Dive,this.squadron=t.Squadron}export(){let t=super.export();return[this.scout+"",this.fighter.toString(),this.torpedo.toString(),this.bomber.toString(),this.squadron.toString()].concat(t)}}class C extends E{init(t){this.id=t.Serial_SNDB,this.name=t.EngineName,this.nation=t.NationCOde,this.maxspeed=t.ShipMaxSpeed,this.overspeed=t.ShipOverSpeed,this.overtime=t.ShipOverSpeedTime}export(){let t=super.export();return[this.name,`${_(this.maxspeed)}`,`${_(this.overspeed)}`,`${this.overtime} Sec`].concat(t)}}let I=[{v:d.BELT,s:"LS_PARAM_BELT"},{v:d.DECK,s:"LS_PARAM_DECK"},{v:d.BULGE,s:"LS_PARAM_BULGE"},{v:d.HULL,s:"LS_PARAM_HULL"},{v:0,s:"None"}];class G extends E{constructor(){super(),this.name="None",this.type=0,this.bulge=0,this.hull=0,this.speedpercent=100,this.belt_armor=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.deck_armor=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}init(t){this.id=t.Serial_SNDB,this.type=t.Type,this.name=this.type.toString(),this.bulge=t.Bulge,this.hull=t.Hull,this.speedpercent=t.SpeedPercent;for(let e=0;e<16;e++)this.belt_armor[e]=t[`b${e+5}`],this.deck_armor[e]=t[`d${e+5}`]}export(){let t=this,e=I.find(e=>e.v==t.type).s,i=y.str(e,e),s=super.export(),a=[i,this.bulge+"%",this.hull+"",this.speedpercent-100+"%"];for(let t=0;t<this.belt_armor.length;t++)a.push(this.belt_armor[t].toString());for(let t=0;t<this.deck_armor.length;t++)a.push(this.deck_armor[t].toString());return a.concat(s)}}class B extends E{init(t){this.id=t.Serial_SNDB,this.divetime=t.DiveTime}export(){let t=super.export();return[this.divetime.toString()].concat(t)}}class O{constructor(t){this.id=t}}let M=[.5,1,1.5,2,2.5],U=[{v:r.OPERATOR,s:"LS_SAILOR_OPERATOR"},{v:r.ARMAMENT,s:"LS_SAILOR_ARMAMENT"},{v:r.ENGINE,s:"LS_SAILOR_ENGINE"},{v:r.REPAIR,s:"LS_SAILOR_REPAIR"},{v:r.SEAMAN,s:"LS_SAILOR_SEAMAN"},{v:r.RADIO,s:"LS_SAILOR_RADIO"},{v:r.AVIATION,s:"LS_SAILOR_AVIATION"}];class F{init(t){this.klass=t.CLASS,this.type=t.TEAM,this.health=t.HEALTH,this.aaw=t.AAW,this.turn=t.TURN,this.divetime=t.DIVE_TIME,this.accurancy=t.ACCURANCY,this.sightrange=t.SIGHT_RANGE,this.gunreload=t.GUN_RELOAD,this.torpedoreload=t.TORPEDO_RELOAD,this.maxspeed=t.SPEED,this.overheadspeed=t.OVERHEAT,this.overheadtime=t.OVERHEAT_TIME,this.repair=t.REPAIR,this.reducedamage=t.REDUCE_DAMAGE,this.airlaunchtime=t.AIR_LAUNCH_TIME,this.airspeed=t.AIR_SPEED,this.airfuel=t.AIR_FUEL,this.airsightrange=t.AIR_SIGHT_RANGE,this.upgrade_xp=[],this.upgrade_time=[],this.upgrade_cost_fuel=[];for(let t=0;t<5;t++)this.upgrade_xp[t]=0,this.upgrade_time[t]=0,this.upgrade_cost_fuel[t]=0;for(let e=1;e<4;e++)this.upgrade_xp[e]=t[`XP${e}`],this.upgrade_time[e]=t[`TIME${e}`],this.upgrade_cost_fuel[e]=t[`TrainCost${e}`];this.master_cost_credit=t.MasterCost,this.master_cost_fuel=t.MasterCostFuel,this.master_cost_steel=t.MasterCostSteel}export(t){let e=U.find(t=>t.v==this.type).s,i=y.str(e,e),s="",a="",n="",r="",h="",l="";0==t||4==t?4==t&&(r=this.master_cost_credit.toString(),h=this.master_cost_steel.toString(),l=this.master_cost_fuel.toString()):(s=this.upgrade_xp[t].toString(),a=this.upgrade_time[t].toString(),n=this.upgrade_cost_fuel[t].toString());let o=M[t];return[i,Math.floor(this.health*o),Math.floor(this.aaw*o),Math.floor(this.turn*o),Math.floor(this.divetime*o),Math.floor(this.accurancy*o),Math.floor(this.sightrange*o),Math.floor(this.gunreload*o),Math.floor(this.torpedoreload*o),Math.floor(this.maxspeed*o),Math.floor(this.overheadspeed*o),Math.floor(this.overheadtime*o),Math.floor(this.repair*o),Math.floor(this.reducedamage*o),Math.floor(this.airlaunchtime*o),Math.floor(this.airspeed*o),Math.floor(this.airfuel*o),Math.floor(this.airsightrange*o),s,a,n,this.master_cost_credit,this.master_cost_fuel,this.master_cost_steel]}}class H{get DebugName(){return`(${this.id})${this.shipname}`}init(t){this.id=t.Serial_SNDB,this.shipname=t.FrameName,this.shipclass=t.Class,this.shipgrade=t.Grade,this.nation=t.Nation,this.dp=t.DP_Default,this.turncap=t.Turn_Differ,this.size_l=t.Length,this.size_w=t.Breadth,this.size_h=t.Depth,this.cost=t.ValueDefault,this.costType=t.Type,this.buildtime=t.BuildTime,this.xpbonus=t.XPBonus,this.fuel=t.Fuel,this.aadef=t.AA_Def,this.aarange=t.AAWRange,this.mountnum=t.No_of_Mount,this.equipments=[];for(let t in u){let e=new v;e.type=Number(t),this.equipments.push(e)}this.mounts=[];for(let e=1;e<this.mountnum+1;e++){let i=new O(e);i.defautEquipmentId=t[`CodeWeapon${e}`],i.driveflag=t[`DriveFlag${e}`],i.controlflag=t[`ControlFlag${e}`],i.mountflag=t[`MountFlag${e}`],this.mounts.push(i)}let e=[];for(let t of this.mounts){let i=e.findIndex(e=>e.id==t.defautEquipmentId);if(-1==i){if(e.push({id:t.defautEquipmentId,num:0}),this.shipclass==a.DD||this.shipclass==a.CL||this.shipclass==a.CA||this.shipclass==a.BB)if(0==t.driveflag){let e=this.equipments.find(t=>t.type==u.GUN),i=S.query("GUN",{Serial_SNDB:t.defautEquipmentId}),s=new D;s.klass=e,s.init(i[0]),e.levels.push(s)}else{let e=v.getEquipmentTypeById(t.defautEquipmentId),i=this.equipments.find(t=>t.type==e);if(e==u.AUTO_GUN){let e=S.query("GUN",{Serial_SNDB:t.defautEquipmentId}),s=new D;s.klass=i,s.init(e[0]),i.levels.push(s)}else if(e==u.LAUNCHER){let e=S.query("LAUNCHER",{Serial_SNDB:t.defautEquipmentId}),s=new L;s.klass=i,s.init(e[0]),i.levels.push(s)}}else if(this.shipclass==a.CV||this.shipclass==a.SS){let e=v.getEquipmentTypeById(t.defautEquipmentId),i=this.equipments.find(t=>t.type==e);if(e==u.AUTO_GUN){let e=S.query("GUN",{Serial_SNDB:t.defautEquipmentId}),s=new D;s.klass=i,s.init(e[0]),i.levels.push(s)}else if(e==u.LAUNCHER){let e=S.query("LAUNCHER",{Serial_SNDB:t.defautEquipmentId}),s=new L;s.klass=i,s.init(e[0]),i.levels.push(s)}}}else e[i].num++}let i=this.equipments.find(t=>t.type==u.GUN),s=this.equipments.find(t=>t.type==u.AUTO_GUN),n=this.equipments.find(t=>t.type==u.LAUNCHER);for(let t of this.mounts)i&&i.levels[0]&&t.defautEquipmentId==i.levels[0].id&&i.count++,s&&s.levels[0]&&t.defautEquipmentId==s.levels[0].id&&s.count++,n&&n.levels[0]&&t.defautEquipmentId==n.levels[0].id&&n.count++;{let e=t.FCS,i=this.equipments.find(t=>t.type==u.FCS),s=S.query("FCS",{Serial_SNDB:e}),a=new b;a.klass=i,a.init(s[0]),i.levels.push(a)}{let e=t.Engine,i=this.equipments.find(t=>t.type==u.ENGINE),s=S.query("ENGINE",{Serial_SNDB:e}),a=new C;a.klass=i,a.init(s[0]),i.levels.push(a)}{let e=t.FlightDeck;if(0!=e){let t=this.equipments.find(t=>t.type==u.FLIGHTDECK),i=S.query("FLIGHTDECK",{Serial_SNDB:e}),s=new q;s.klass=t,s.init(i[0]),t.levels.push(s)}}{let e=t.Oxygen;if(0!=e){let t=this.equipments.find(t=>t.type==u.OXYGEN),i=S.query("OXYGEN",{Serial_SNDB:e}),s=new B;s.klass=t,s.init(i[0]),t.levels.push(s)}}{let t=this.equipments.find(t=>t.type==u.ARMOR),e=new G;e.klass=t,t.levels.push(e)}{let e=["AircraftScoutSNDB","AircraftFighterSNDB","AircraftTorpedoSNDB","AircraftBomberSNDB"];for(let i of e){let e=t[i];if(0!=e){let t=this.equipments.find(t=>t.type==u.AIRCRAFT),i=S.query("AIRCRAFT",{Serial_SNDB:e}),s=i[0].AirCraftType;if(0==t.levels.length){let e=new R;t.levels.push(e),e.klass=t}let a=t.levels[0],n=new T;a.plainMap.set(s,n),n.init(i[0])}}}let r=S.query("EQUIPMENT",{Serial_SNDB:this.id});if(r&&r.length>0){let t=r[0],e=["A","B","C","D","E","F"];for(let i of e){let e=t[`${i}_TYPE`];if(0!=e&&"0"!=e){let s=v.getEquipmentTypeByStr(e);for(let e=1;e<m+1;e++){let a=`${i}${e}`,n=t[`${a}_SNDB`],r=this.equipments.find(t=>t.type==s);if(r.type==u.GUN||r.type==u.AUTO_GUN){let e=new D;e.klass=r;let i=S.query("GUN",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(r.type==u.LAUNCHER){let e=v.getEquipmentTypeById(n);if(e==u.LAUNCHER){let e=new L;e.klass=r;let i=S.query("LAUNCHER",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(e==u.AUTO_GUN){let e=new D;e.klass=r;let i=S.query("GUN",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}}else if(r.type==u.AIRCRAFT){let e=new R;e.klass=r;let i=S.query("AIRCRAFT",{Serial_SNDB:n});r.levels.push(e);let s=i[0].AirCraftType,h=new T;e.loadEquipmentInfo(t,a),h.init(i[0]),e.plainMap.set(s,h)}else if(r.type==u.ARMOR||r.type==u.HULL){let e=new G;e.klass=r;let i=S.query("SHIELD",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(r.type==u.ENGINE){let e=new C;e.klass=r;let i=S.query("ENGINE",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(r.type==u.FCS){let e=new b;e.klass=r;let i=S.query("FCS",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(r.type==u.FLIGHTDECK){let e=new q;e.klass=r;let i=S.query("FLIGHTDECK",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}else if(r.type==u.OXYGEN){let e=new B;e.klass=r;let i=S.query("OXYGEN",{Serial_SNDB:n});e.loadEquipmentInfo(t,a),e.init(i[0]),r.levels.push(e)}}}}}this.crews=new Map;let h=this.shipclass,l=S.query("CREW",{CLASS:h});for(let t of l){let e=new F;e.init(t),this.crews.set(e.type,e)}}exportBaseData(){let t=0,e=this.equipments.find(t=>t.type==u.FLIGHTDECK);if(e&&e.levels[0]){t=e.levels[0].scout}let i=this.equipments.find(t=>t.type==u.ENGINE).levels[0],s=this.equipments.find(t=>t.type==u.FCS).levels[0],a=this.cost.toString()+(0==this.costType?" Steel":" Gold");this.DPS=0,this.GunTurretNum=0,this.GunBarrelNum=0,this.GunDamage=0,this.GunReloadTime=0;let n=this.equipments.find(t=>t.type==u.GUN);if(n&&n.levels[0]){let t=n.levels[0];this.GunTurretNum=n.count,this.GunBarrelNum=t.barrelnum,this.GunDamage=t.hedamage,this.GunRange=t.range,this.GunReloadTime=t.reloadtime,this.DPS=t.hedamage*this.GunTurretNum*this.GunBarrelNum*100/t.reloadtime}this.LauncherNum=0;let r=this.equipments.find(t=>t.type==u.LAUNCHER);return r&&r.levels[0]&&(this.LauncherNum=r.count),{titles:[{text:"XP Bonus"},{text:"DP"},{text:"Max Speed"},{text:"Overheat Speed"},{text:"Overheat Time"},{text:"AA Damage"},{text:"AA Range"},{text:"scouts"},{text:"Sight Range"},{text:"Radar Range"},{text:"Sonar Range"},{text:"Critical"},{text:"Main Gun Turrets"},{text:"Main Gun Barrels"},{text:"Main Gun Range"},{text:"Main Gun Damage"},{text:"Main Gun Reload"},{text:"DPS"},{text:"Launchers"},{text:"Build Time"},{text:"Cost"}],data:[this.xpbonus,this.dp,`${i.maxspeed} kn`,`${i.overspeed} kn`,`${i.overtime} Sec`,this.aadef,this.aarange,t,s.sightdist,s.radarrange,s.sonarrange,`${s.criticalrate} %`,this.GunTurretNum,this.GunBarrelNum,this.GunRange,this.GunDamage,`${(this.GunReloadTime/100).toFixed(2)} Sec`,this.DPS.toFixed(0),this.LauncherNum,`${this.buildtime} Sec`,a]}}exportExtraData(){return{titles:[{text:"Size"},{text:"Turn Cap"},{text:"Weapons"}],data:[`L:${this.size_l} x W:${this.size_w} x H:${this.size_h}`,this.turncap,this.mountnum]}}exportGunsData(t){let e=[],i=this.equipments.find(e=>e.type==t).levels;for(let t of i){let i=[];i.push(t.export()),e.push({items:i})}return{titles:[{text:"Level",width:64},{text:"Name",width:192},{text:"Amount",width:32},{text:"Barrel",width:48},{text:"Calibre",width:64},{text:"Damage",width:64},{text:"Range",width:64},{text:"Reload",width:64},{text:"TurnSpeed",width:96},{text:"AA Damage",width:96},{text:"AAW",width:48},{text:"Build Time",width:48},{text:"Cost",width:64}],levels:e}}exportLaunchersData(){let t=[],e=this.equipments.find(t=>t.type==u.LAUNCHER);for(let i of e.levels){let e=[];i instanceof D?e.push(i.exportAsLauncher()):i instanceof L&&e.push(i.export()),t.push({items:e})}return{titles:[{text:"Level",width:64},{text:"Name",width:192},{text:"Amount",width:32},{text:"Bundle",width:48},{text:"Damage",width:64},{text:"Range",width:64},{text:"Reload",width:96},{text:"Speed",width:96},{text:"Build Time",width:48},{text:"Cost",width:64}],levels:t}}exportEnginesData(){let t=[],e=this.equipments.find(t=>t.type==u.ENGINE);for(let i of e.levels)t.push({items:[i.export()]});return{titles:[{text:"Level",width:64},{text:"Name",width:192},{text:"MaxSpeed",width:96},{text:"OverheatSpeed",width:96},{text:"OverheatTime",width:96},{text:"Build Time",width:48},{text:"Cost",width:64}],levels:t}}exportFCSsData(){let t=[],e=this.equipments.find(t=>t.type==u.FCS);for(let i of e.levels){let e=[];e.push(i.export()),t.push({items:e})}return{titles:[{text:"Level",width:64},{text:"Name",width:100},{text:"Accuracy",width:96},{text:"SightRange",width:96},{text:"RadarRange",width:96},{text:"SonarRange",width:96},{text:"TorpedoRange",width:96},{text:"Critical",width:96},{text:"Build Time",width:64},{text:"Cost",width:96}],levels:t}}exportFlightDecksData(){let t=[],e=this.equipments.find(t=>t.type==u.FLIGHTDECK);for(let i of e.levels){let e=[];e.push(i.export()),t.push({items:e})}return{titles:[{text:"Level",width:64},{text:"Scout",width:96},{text:"Fighter",width:96},{text:"Torpedo",width:96},{text:"Bomber",width:96},{text:"Squadron",width:96},{text:"Build Time",width:64},{text:"Cost",width:94}],levels:t}}exportAircraftData(){let t=[],e=this.equipments.find(t=>t.type==u.AIRCRAFT);for(let i of e.levels){let e=i.exportAircraftPlains();t.push({items:e})}return{titles:[{text:"Level",width:64},{text:"Name",width:192},{text:"Type",width:48},{text:"SightRange",width:48},{text:"DP",width:64},{text:"Speed",width:64},{text:"Fuel",width:64},{text:"Attack",width:64},{text:"AttackInterval",width:64},{text:"DefenceAP",width:64},{text:"ReadyTime",width:64},{text:"TorpedoSpeed",width:64},{text:"TorpedoDamage",width:64},{text:"BombDamage",width:64},{text:"APDamageBonus",width:64},{text:"Build Time",width:64},{text:"Cost",width:94}],levels:t}}exportArmorData(){let t=[],e=this.equipments.find(t=>t.type==u.ARMOR);for(let i of e.levels){let e=[];e.push(i.export()),t.push({items:e})}return{titles:'                    <tr>\n                        <th rowspan="2" style="width: 64px;">Level</th>\n                        <th rowspan="2" style="width: 64px;">Name</th>\n                        <th rowspan="2" style="width: 64px;">Bulge</th>\n                        <th rowspan="2" style="width: 64px;">Hull</th>\n                        <th rowspan="2" style="width: 64px;">Speed</th>\n                        <th colspan="16">Belt Damage Reduction</th>\n                        <th colspan="16">Deck Damage Reduction</th>\n                        <th rowspan="2" style="width: 64px;">Built Time</th>\n                        <th rowspan="2" style="width: 94px;">Cost</th>\n                    </tr>\n                    <tr class="damagereducion_tr">\n                        <th>5"</th><th>6"</th><th>7"</th><th>8"</th><th>9"</th><th>10"</th><th>11"</th><th>12"</th><th>13"</th><th>14"</th><th>15"</th><th>16"</th><th>17"</th><th>18"</th><th>19"</th><th>20"</th>\n                        <th>5"</th><th>6"</th><th>7"</th><th>8"</th><th>9"</th><th>10"</th><th>11"</th><th>12"</th><th>13"</th><th>14"</th><th>15"</th><th>16"</th><th>17"</th><th>18"</th><th>19"</th><th>20"</th>\n                    </tr>',levels:t}}exportOxygensData(){let t=[],e=this.equipments.find(t=>t.type==u.OXYGEN);for(let i of e.levels){let e=[];e.push(i.export()),t.push({items:e})}return{titles:[{text:"Level",width:64},{text:"Dive Time",width:96},{text:"Build Time",width:64},{text:"Cost",width:94}],levels:t}}exportCrewsData(){let t=[];for(let e=0;e<5;e++){let i=[];for(let t of this.crews.values())i.push(t.export(e));t.push({items:i})}return{titles:[{text:"Level",width:48},{text:"Team",width:48},{text:"Health",width:48},{text:"AAW",width:48},{text:"Turn",width:48},{text:"DiveTime",width:48},{text:"Accurancy",width:48},{text:"Sight Range",width:48},{text:"Gun Reload Time",width:48},{text:"Torpedo Reload TIme",width:48},{text:"Max Speed",width:48},{text:"Overhead Speed",width:48},{text:"Overhead Time",width:48},{text:"Repair",width:48},{text:"Reduce Damage",width:48},{text:"Air Launch TIme",width:48},{text:"Air Speed",width:48},{text:"Air Fuel",width:48},{text:"Air Sight Range",width:48},{text:"Upgrade XP",width:48},{text:"Upgrade Time",width:48},{text:"Upgrade Fuel Cost",width:64},{text:"Master Credit Cost",width:48},{text:"Master Fuel Cost",width:96},{text:"Master Steel Cost",width:96}],levels:t}}}i.d(e,"Main",function(){return P});var k=function(t,e,i,s){return new(i||(i=Promise))(function(a,n){function r(t){try{l(s.next(t))}catch(t){n(t)}}function h(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,h)}l((s=s.apply(t,e||[])).next())})};window.AsyncStart=function(){P.Start()};class P{static Start(){return k(this,void 0,void 0,function*(){this.init(),yield S.init(),this.m_jq_win_loading.window("open"),yield y.init("en"),console.log("nfm start"),this.m_inited=!0,this.m_jq_win_loading.window("close")})}static init(){let t=this;this.m_inited=!1,this.m_jq_cb_dbver=$("#dbversion"),this.m_jq_cb_dbver.combobox({editable:!1}),this.m_jq_cb_nation=$("#nation"),this.m_jq_cb_nation.combobox({valueField:"value",textField:"text",editable:!1,onSelect:function(e){t.m_nation=e.value,t.refreshL1()}}),this.m_jq_cb_nation.combobox("setValue",s.ALL),this.m_jq_cb_shipclass=$("#shipclass"),this.m_jq_cb_shipclass.combobox({valueField:"value",textField:"text",editable:!1,onSelect:function(e){t.m_shipclass=e.value,t.refreshL1()}}),this.m_jq_cb_shipclass.combobox("setValue",a.ALL),this.m_jq_cb_shipgrade=$("#shipgrade"),this.m_jq_cb_shipgrade.combobox({valueField:"value",textField:"text",editable:!1,onSelect:function(e){t.m_shipgrade=e.value,t.refreshL1()}}),this.m_jq_cb_shipgrade.combobox("setValue",n.ALL),this.m_jq_cb_shipname=$("#shipname"),this.m_jq_cb_shipname.combobox({valueField:"value",textField:"text",editable:!1,onSelect:function(e){let i=t.m_last_shiplist.findIndex(t=>t.Serial_SNDB==e.value);t.m_selected_ship=-1!=i?t.m_last_shiplist[i]:null,t.refreshL2()}}),this.m_jq_base_div=$("base_div"),this.m_jq_img_shipimage=$("#ship_img"),this.m_jq_tab_base_table=$("#tab_base_table"),this.m_jq_tab_extra_table=$("#tab_extra_table"),this.m_jq_tab_gun_table=$("#tab_gun_table"),this.m_jq_tab_autogun_table=$("#tab_autogun_table"),this.m_jq_tab_launcher_table=$("#tab_launcher_table"),this.m_jq_tab_aircraft_table=$("#tab_aircraft_table"),this.m_jq_tab_fcs_table=$("#tab_fcs_table"),this.m_jq_tab_engine_table=$("#tab_engine_table"),this.m_jq_tab_flightdeck_table=$("#tab_flightdeck_table"),this.m_jq_tab_armor_table=$("#tab_armor_table"),this.m_jq_tab_oxygen_table=$("#tab_oxygen_table"),this.m_jq_tab_crew_table=$("#tab_crew_table"),this.m_jq_win_loading=$("#loading")}static refreshL1(){if(!this.m_inited)return;let t=Object();this.m_nation!=s.ALL&&(t.Nation=this.m_nation),this.m_shipclass!=a.ALL&&(t.Class=this.m_shipclass),this.m_shipgrade!=n.ALL&&(t.Grade=this.m_shipgrade),this.m_last_shiplist=S.query("SHIP",t);let e=[];for(let t of this.m_last_shiplist){let i=t.Shop;if(1==i||2==i){let i=this.getShipFullName(t);e.push({value:t.Serial_SNDB,text:i})}}this.m_jq_cb_shipname.combobox("loadData",e)}static getShipClassStr(t){return t==a.DD?"DD":t==a.CL?"CL":t==a.CA?"CA":t==a.BB?"BB":t==a.CV?"CV":t==a.SS?"SS":t.toString()}static getShipGradeStr(t){return t==n.S?"S":t==n.A?"A":t==n.B?"B":t==n.C?"C":t==n.D?"D":t==n.E?"E":t==n.F?"F":"?"}static getShipFullName(t){let e=t.FrameName.substr(3);return e=y.str(t.FrameName,e),`[${this.getShipClassStr(t.Class)}]${e} - ${this.getShipGradeStr(t.Grade)}`}static refreshL2(){if(null==this.m_selected_ship)this.m_jq_img_shipimage.src="";else{let t=S.query("ASSET_SHIP",{Serial_SNDB:this.m_selected_ship.Serial_SNDB});if(null!=t&&t.length>0){let e=`./asset/data_ship/${t[0].UIFolder}/Image.png`;this.m_jq_img_shipimage.attr("src",e);let i=new H;i.init(this.m_selected_ship),this.makeTable(this.m_jq_tab_base_table,i.exportBaseData()),this.makeTable(this.m_jq_tab_extra_table,i.exportExtraData()),this.makeLevelTable(this.m_jq_tab_gun_table,i.exportGunsData(u.GUN)),this.makeLevelTable(this.m_jq_tab_autogun_table,i.exportGunsData(u.AUTO_GUN)),this.makeLevelTable(this.m_jq_tab_launcher_table,i.exportLaunchersData()),this.makeLevelTable(this.m_jq_tab_engine_table,i.exportEnginesData()),this.makeLevelTable(this.m_jq_tab_flightdeck_table,i.exportFlightDecksData()),this.makeLevelTable(this.m_jq_tab_aircraft_table,i.exportAircraftData()),this.makeLevelTable(this.m_jq_tab_fcs_table,i.exportFCSsData()),this.makeLevelTable(this.m_jq_tab_armor_table,i.exportArmorData()),this.makeLevelTable(this.m_jq_tab_oxygen_table,i.exportOxygensData()),this.makeLevelTable(this.m_jq_tab_crew_table,i.exportCrewsData())}}}static wait(){return new Promise((t,e)=>{setTimeout(()=>t(),10)})}static makeTable(t,e){t.children().remove();let i="";for(let t=0;t<e.titles.length;t++)i+=`<tr><th>${e.titles[t].text}:</th><td>${e.data[t]}</td></tr>`;t.append(i)}static makeLevelTable(t,e){t.children().remove();let i="";if(null!=e.titles)if(e.titles instanceof Array){i+="<tr>";for(let t of e.titles)i+=`<th width="${t.width}px">${t.text}</th>`;i+="</tr>"}else i+=e.titles;for(let t=0;t<e.levels.length;t++){let s=e.levels[t];for(let e=0;e<s.items.length;e++){let a=s.items[e];i+="<tr>",0==e&&(i+=`<td rowspan="${s.items.length}">Lv.${t}</td>`);for(let t of a)i+=`<td>${t}</td>`;i+="</tr>"}}t.append(i)}static exportKeyWords(){return k(this,void 0,void 0,function*(){let t=[],e=[],i=S.query("SHIP",void 0);for(let t of i)e.push(t.FrameName);yield y.init("zh-Hans");for(let i of e)t.push(y.str(i,i));yield y.init("en");for(let i of e)t.push(y.str(i,i));console.log(t.join(","))})}}}]);
//# sourceMappingURL=nfm.js.map